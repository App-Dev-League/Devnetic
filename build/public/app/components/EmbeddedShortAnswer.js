const ModuleComponent=require("./ModuleComponent.js"),ExplanationModal=require("./ExplanationModal.js"),codeTemplateToCode=require("../utils/codeTemplateToCode.js"),modals=require("../utils/modal.js"),Database=require("../utils/Database.js");class EmbeddedShortAnswer extends ModuleComponent{constructor(t,e){super(t,e)}handleOptionClick(t){var e=this;this.parent.state.value=t,e.state.graderFunction(t)?(this.parent.state.status="correct_chosen",Database.updateMCPoints(window.location.hash.split("/")[2],window.location.hash.split("/")[3],window.location.hash.split("/")[4],this.state.elementNum,this.state.points,this.state.coins),modals.show("Correct! ðŸŽ‰",`${this.state.correctDescription}<br><br>+${this.state.points} XP<br>+${this.state.coins} coins`,[{type:"button",text:"Continue",onclick:function(){e.correct()}},{type:"cancel",onclick:function(){e.correct()}}])):(this.parent.state.status="incorrect_chosen",modals.show("Incorrect!",`${this.state.incorrectDescription}<br>
			<hr>
			"${modals.randomQuote()}"
			`,[{type:"button",text:"Try again"}])),this.setState("options",this.state.options)}handleKeyUp(t){console.log(t)}correct(){if(this.state.explanation.setState("title",""),!0!==this.parent.state.alreadyCorrectAnswer){this.parent.state.alreadyCorrectAnswer=!0;try{tApp.getComponentFromDOM(document.querySelector(".stack-width")).increaseCompletedQuestions()}catch(t){}var t=document.querySelector(`[tapp-component="${this.id}"]`).parentElement.parentElement.querySelector(".mc-answer-confetti");t.confetti=t.confetti||confetti.create(t,{resize:!0}),t.confetti({spread:150,origin:{y:1.3},particleCount:200,decay:.91,scalar:.8}),t.parentElement.querySelector(".indicator-symbol").style.color="var(--chakra-colors-green-500)",(document.querySelector(".stack-width > .mdd-render")||document.querySelector(".stack-width")).children[getElementIndex(t.parentElement)+1].scrollIntoView({behavior:"auto",block:"center"}),document.querySelector(".stack-width").children[getElementIndex(t.parentElement)+1].className.includes("multiple-choice-wrapper")||setTimeout(function(){document.querySelector(".stack-width").classList.remove("blur-all-non-mc-questions")},100)}}componentHasUpdated(){var e=this;let t=document.querySelector(`[tapp-component="${this.id}"]`);t&&(t.querySelector("input").onkeyup=function(t){"Enter"===t.key&&e.handleOptionClick(t.target.value)})}render(t){return this.state.explanation?(this.state.explanation.state.points=this.state.points,this.state.explanation.state.coins=this.state.coins,`<div>
	<div class="mc-answer-container mc-answer-container-embeded">
			<div class="mc-input-wrapper"><input value="${(this.parent.state.value||"").replace(/"/g,"&quot;")}" class="mc-input" style="width: 100%; box-sizing: border-box" placeholder="${(this.state.placeholder||"Answer Here").replace(/"/g,"&quot;")}"></div>
           
            <div class="ui-modal-buttons" style="margin-top: 20px; height: 36px; width: 100%; position: relative; display: block"><button onclick="{{_this}}.handleOptionClick(this.parentElement.parentElement.querySelector('input').value)" style="position: absolute; right: 0px; margin-right: 0">Submit</button></div>

            </div>`+"<div>"+this.state.explanation.toString()+"</div></div>"):(this.setState("explanation",new ExplanationModal({points:this.state.points,coins:this.state.coins},this)),"<div></div>")}closeModal(){this.parent.setState("data.selectedAnswer",null)}}class ShortAnswerWrapper extends tApp.Component{constructor(t,e){super(t,e),null===this.state.status&&(this.state.status="not_chosen"),null===this.state.value&&(this.state.value=""),this.state.alreadyCorrectAnswer=!1}render(t){var e=this.state;return`<div>
				${new EmbeddedShortAnswer(e,this)}
			</div>`}}function getElementIndex(t){for(var e=0;t=t.previousElementSibling;)e++;return e}module.exports=ShortAnswerWrapper;