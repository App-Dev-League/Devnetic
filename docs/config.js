function recurseEjs(o,n={}){return new Promise(async(e,t)=>{n.include=async function(e){let t=await tApp.get(e);return recurseEjs(await t.text(),n)},e(await ejs.render(o,n,{async:!0}))})}function confirmRedoLesson(){return new Promise((e,t)=>{let o=document.getElementById("snippets-modal"),n=o.cloneNode(!0),r=(n.removeAttribute("id"),n.classList.remove("none"),n.querySelector("h3").innerHTML="You have already completed this module!",n.querySelector("h3").style.fontSize="1.5em",n.querySelector(".button-correct").innerHTML="Redo Module",n.querySelector(".button-correct").cloneNode());r.innerHTML="Next Module",r.style.marginLeft="10px",r.style.backgroundColor="var(--blue-selected)",n.querySelector(".button-correct").parentNode.appendChild(r),n.querySelector("span").onclick=function(){e("stay"),n.parentNode.removeChild(n)},n.querySelector(".button-correct").onclick=async function(){n.parentElement.removeChild(n),e(!0)},document.body.appendChild(n)})}(async()=>{await installAll(["CodeEditor.js","CodePreview.js","Congratulations.js","Editor.js","ExplanationModal.js","Information.js","Input.js","Instructions.js","ModuleComponent.js","ModulePage.js","MultipleChoice.js","MultipleChoiceOption.js","ShortAnswer.js","SnippetsPanel.js","SnippetUnlock.js","TabbedView.js","codeBlock.js","PluginPanel.js"],{path:"./components/"}),await installAll(["Database.js","codeEditor.js","codeTemplateToCode.js","compileSnippet.js","shuffleArray.js","codeBlocks.js","plugins.js"],{path:"./utils/"}),await install("./assets/libraries/ejs.js");const e=require("./components/ModulePage.js"),m=require("./components/Information.js"),h=require("./components/MultipleChoice.js"),y=require("./components/ShortAnswer.js"),w=require("./components/SnippetUnlock.js"),f=require("./components/Congratulations.js"),l=require("./components/CodeEditor.js"),g=require("./utils/codeTemplateToCode.js"),j=require("./utils/shuffleArray.js"),b=require("./utils/Database.js");require("./utils/plugins.js"),require("./assets/libraries/ejs.js");var t={target:document.querySelector("tapp-main"),ignoreRoutes:[],forbiddenRoutes:[],errorPages:{notFound:"#/404",forbidden:"#/403"},caching:{backgroundPages:["/tApp.js","/require-browser.js","/","/config.js","/index.html","/manifest.json",...["ai","index","intro-to-cs","menu","my-projects","webdev-projects","webdev"].map(e=>`/views/${e}.html`),...["codeBlocks","codeEditor","codeTemplateToCode","compileSnippet","Database","plugins","shuffleArray"].map(e=>`/utils/${e}.js`),...["0","1","2","3","4","5","6","7"].map(e=>`/data/modules/ai/${e}.json`),...["0","1","2","3","4","5","6","7"].map(e=>`/data/modules/webdev/${e}.json`),...["0","1","2","3","4","5","6","7"].map(e=>`/data/modules/webdev-projects/${e}.json`),...["0","1"].map(e=>`/data/modules/intro-to-cs/${e}.json`),...["codeBlock","CodeEditor","CodePreview","Congratulations","Editor","ExplanationModal","Information","Input","Instructions","ModuleComponent","ModulePage","MultipleChoice","MultipleChoiceOption","PluginPanel","ShortAnswer","SnippetUnlock","SnippetsPanel","TabbedView"].map(e=>`/components/${e}.js`),"/assets/fonts/codicon.ttf",...["Black.ttf","BlackItalic.ttf","Bold.woff2","BoldItalic.ttf","ExtraBold.woff2","ExtraBoldItalic.ttf","ExtraLight.ttf","ExtraLightItalic.ttf","Italic.ttf","Light.ttf","LightItalic.ttf","Regular.woff2","SemiBold.woff2","SemiBoldItalic.ttf"].map(e=>"/assets/fonts/Nunito/Nunito-"+e),"/assets/fonts/Nunito/OFL.txt","/assets/html/code-editor.html",...["icon","screenshot"].map(e=>`/assets/img/${e}.png`),"/assets/libraries/highlightjs/atom-one-dark.css","/assets/libraries/highlightjs/highlight.min.js","/assets/libraries/monaco-editor/vs/loader.js",...["ejs","jquery"].map(e=>`/assets/libraries/${e}.js`),...["betterEditor/betterEditor.min.js","betterEditor/betterEditor.png","betterEditor/VERSION.txt","brython/brython.min.js","brython/brython.svg","brython/VERSION.txt","captCC/captCC.min.js","captCC/captCC.svg","captCC/VERSION.txt","hexy/hexy.min.js","hexy/logo.png","hexy/VERSION.txt","jscpp/jscpp.min.js","jscpp/jscpp.svg","jscpp/VERSION.txt","react/react.min.js","react/react.svg","react/VERSION.txt","showdown/showdown.min.js","showdown/markdown-logo.png","showdown/VERSION.txt","typescript/typescript.min.js","typescript/typescript.svg","typescript/VERSION.txt","webperl/webperl.min.js","webperl/webperl.png","webperl/VERSION.txt"].map(e=>"/assets/plugins/"+e)],periodicUpdate:6e4,persistent:!0}};"development"==window.environment&&(t.caching=null),tApp.configure(t),tApp.route("/",function(e){tApp.redirect("#/")}),tApp.route("#/",function(e){tApp.get("./views/index.html").then(e=>e.text()).then(async e=>{e=await recurseEjs(e);tApp.render(e)})}),tApp.route("#/track/<track>",function(e){tApp.get(`./views/${e.data.track}.html`).then(e=>e.text()).then(async e=>{e=await recurseEjs(e);tApp.render(e)}).catch(e=>{tApp.renderPath("#/404")})}),tApp.route("#/my-projects",function(e){tApp.get("./views/my-projects.html").then(e=>e.text()).then(async e=>{e=await recurseEjs(e,{myProjectsPage:!0});tApp.render(e)})}),tApp.route("#/learn/<track>/<module>/",async function(e){tApp.redirect(`#/learn/${e.data.track}/${e.data.module}/${await b.getModulePosition(e.data.track,e.data.module)}/`)}),window.DB=b,tApp.route("#/preview/html/<id>/autoupdate",async function(e){let t=e.data.id;if(!t.endsWith(".html")&&!t.endsWith(".jsx"))return tApp.render(`
			<h1>Error</h1>
			<p>Currently, only HTML and JSX files are only supported in window preview mode :(</p>`);await b.getCode(t)||tApp.render("<h4>We couldn't find your file!</h4>");e=`
			document.getElementById("preview").srcdoc = await window.DB.getCode("${t}")`;t.endsWith(".jsx")&&(e=`
			const plugins = require("./utils/plugins.js");
			   async function main(){
					await plugins.load("react");
					let code = await window.DB.getCode("${t}")
					code = Babel.transform(code, {
						plugins: ["transform-react-jsx"]
					}).code;
					document.getElementById("preview").srcdoc = "<html> <body> <div id='root'></div> <script>"+plugins.getCode("react")+"<\\/script><script>"+code+"<\\/script></body></html>";
			   }
			   main()
			`),tApp.render(`<div>
		<script>
		async function load(){
		${e}
		}
		load();
		window.addEventListener('storage', load)
		</script>
		<style>header{display: none !important}</style><script></script><iframe id="preview" srcdoc="Loading...." style="width: 100vw; height: 100vh; border: none; background: white; position: fixed; z-index: 500; top: 0; left 0; display: block"></iframe></div>
		<script>
		document.getElementById("preview").onload = function(){
			document.title = document.getElementById("preview").contentDocument.title;
		}
		</script>
		`)}),tApp.route("#/preview/html/<id>",async function(e){e=e.data.id;let t=await b.getCode(e);t||tApp.render("<h4>We couldn't find your file!</h4>"),t=t.replace(/"/g,"&quot;"),tApp.render(`<div><style>header{display: none !important}</style><script></script><iframe id="preview" srcdoc="${t}" style="width: 100vw; height: 100vh; border: none; background: white; position: fixed; z-index: 500; top: 0; left 0; display: block"></iframe></div>`)});let A=new e({Database:b});tApp.route("#/learn/<track>/<module>/<position>",function(p){async function t(e,t=!1){let{data:s,type:o,moduleLength:n,next:r,moduleData:i}=e,a=(document.getElementById("module-progress-bar").style.width=p.data.position/n*100+"%",window.tAppRequestInstance=p,window.currentModuleData=i,0);if(document.querySelectorAll(".module-progress-bar-timeline-element").forEach(e=>{e.classList.contains("template")||e.parentElement.removeChild(e)}),t||window.currentModuleData.pages.forEach(e=>{let t=document.getElementById("module-progress-bar-wrapper"),o=t.querySelector(".template"),n=o.cloneNode(!0);n.classList.remove("template"),n.style.left=a/window.currentModuleData.pages.length*100+"%",p.data.position>a?n.classList.add("filled"):n.classList.remove("filled"),"information"===e.type&&(n.querySelector(".name").innerText=e.title||"",n.querySelector(".descriptor").innerHTML="<b>Type: </b>Learn"),"multiple_choice"===e.type&&(n.querySelector(".name").innerText=e.question.slice(0,10)+"..."||"",n.querySelector(".descriptor").innerHTML="<b>Type: </b>Question"),"snippet_unlock"===e.type&&(n.querySelector(".name").innerText=e.name.slice(0,10)+"..."||"",n.querySelector(".descriptor").innerHTML="<b>Type: </b>Snippet"),"short_answer"===e.type&&(n.querySelector(".name").innerText=e.question.slice(0,10)+"..."||"",n.querySelector(".descriptor").innerHTML="<b>Type: </b>Question"),"congratulations"===e.type&&(n.querySelector(".name").innerText="Lesson summary",n.querySelector(".descriptor").innerHTML="<b>Type: </b>Summary"),"code_editor"===e.type&&(n.querySelector(".name").innerText=e.elements[0].content.replaceAll("[[h3]]","").replaceAll("[[/]]",""),n.querySelector(".descriptor").innerHTML="<b>Type: </b>Project"),a++,t.appendChild(n)}),p.data.position>=n)return!0===(e=await confirmRedoLesson())?tApp.redirect(`#/learn/${p.data.track}/${p.data.module}/0`):"stay"===e?tApp.redirect("#/track/"+p.data.track):void(r.hasNext?tApp.redirect(`#/learn/${p.data.track}/${r.module}/`+r.position):tApp.redirect("#/"));if("lesson"==o||"project"==o){if(null!=s.code_template&&(s.code=g(s.code_template)),r.hasNext?A.state.next=`#/learn/${p.data.track}/${r.module}/`+r.position:A.state.next="#/",A.state.track=p.data.track,A.state.module=p.data.module,A.state.position=p.data.position,"information"==s.type)A.setComponent(new m({},A),s);else if("multiple_choice"==s.type){let o=j([...s.answers]),n=[];for(let t=0;t<o.length;t++)n.push(s.answers.findIndex(e=>e===o[t]));let t=[];for(let e=0;e<n.length;e++)t.push(s.answers[n[e]]);let r=[];for(let e=0;e<n.length;e++)r.push(s.descriptions[n[e]]);if(s.answers=t,s.descriptions=r,Array.isArray(s.correct)){let e=[...s.correct];s.correct=[],e.forEach(t=>s.correct.push(n.findIndex(e=>e===t)))}else s.correct=n.findIndex(e=>e===s.correct);A.setComponent(new h({},A),s)}else"short_answer"==s.type?A.setComponent(new y({},A),s):"snippet_unlock"==s.type?A.setComponent(new w({},A),s):"congratulations"==s.type?A.setComponent(new f({},A),s):"code_editor"==s.type&&(s.isUserProject=t,A.setComponent(new l({},A),s));tApp.render(A.toString())}else tApp.renderPath("#/404"),console.error("Unknown type "+o)}p.data.module=parseInt(p.data.module),p.data.position=parseInt(p.data.position),"customUserProjects"===p.data.track?t({type:"project",moduleLength:1,next:{hasNext:!0,module:p.data.module,position:1},data:{type:"code_editor",storage_id:[],files:[],default:[],display_type:"web",elements:[],hints:[],validation:[],points:0,coins:0}},!0):b.getModuleData(p.data.track,p.data.module,p.data.position).then(async e=>{t(e)}).catch(e=>{tApp.renderPath("#/404")})}),tApp.route("#/DEV-SHOW-ALL",async function(i){var a="",o={},t={"Webdev Lessons":"webdev","Webdev Projects":"webdev-projects","AI Lessons":"ai"},n={};for(let e=0;e<Object.entries(t).length;e++){Object.entries(t)[e][0];var r=Object.entries(t)[e][1],s=(o[r]=[],0),p=0,l=DB.getModuleCount(r),c=[];for(let t=0;t<l;t++){let e=await DB.getModuleData(r,t,0);var d=await DB.getModulePosition(r,t);o[r].push(d),e.currentUserPosition=d,c.push(e),s+=e.moduleLength}o[r]?(o[r].forEach(e=>{null!==e&&(p+=e)}),n[r]={totalPages:s,userPages:p,data:c}):n[r]={totalPages:s,userPages:0,data:c}}var u=[];Object.entries(n).forEach(([r,e])=>{e.data.forEach((e,n)=>{for(let t=0;t<e.moduleLength-1;t++)u.push(new Promise((o,e)=>{b.getModuleData(r,n,t).then(t=>{try{let{data:s,type:e}=t;if(window.tAppRequestInstance=i,"lesson"==e||"project"==e){if(null!=s.code_template&&(s.code=g(s.code_template)),"information"==s.type)A.setComponent(new m({},A),s);else if("multiple_choice"==s.type){let o=j([...s.answers]),n=[];for(let t=0;t<o.length;t++)n.push(s.answers.findIndex(e=>e===o[t]));let t=[];for(let e=0;e<n.length;e++)t.push(s.answers[n[e]]);let r=[];for(let e=0;e<n.length;e++)r.push(s.descriptions[n[e]]);if(s.answers=t,s.descriptions=r,Array.isArray(s.correct)){let e=[...s.correct];s.correct=[],e.forEach(t=>s.correct.push(n.findIndex(e=>e===t)))}else s.correct=n.findIndex(e=>e===s.correct);A.setComponent(new h({},A),s)}else"short_answer"==s.type?A.setComponent(new y({},A),s):"snippet_unlock"==s.type?A.setComponent(new w({},A),s):"congratulations"==s.type&&A.setComponent(new f({},A),s);A&&(a+=A.toString()),o()}}catch(e){o()}})}))})}),await Promise.all(u),await new Promise((e,t)=>{setTimeout(()=>{e()},500)}),console.log("Done"),tApp.render(a)}),tApp.route("#/404",function(e){tApp.render(`
			<h1>Error 404</h1>
			<p>Page not found.</p>
		`)}),tApp.route("#/403",function(e){tApp.render(`
			<h1>Error 403</h1>
			<p>Access denied.</p>
		`)});t=await b.getScore();document.querySelector("#score").innerHTML=`${t.points} XP, ${t.coins} Coins`,tApp.start().then(()=>{"development"!==window.environment&&tApp.install().then(()=>{tApp.update()})})})();